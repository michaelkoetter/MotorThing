<move class="app-page">
    <header class="header-bar">
        <a data-navigation="$previous-page" class="btn pull-left icon icon-arrow-back"></a>
        <a class="btn pull-right" onclick="{ selectMotor }">Motor { motor }</a>

        <h1 class="title">
          Move: { module().version }
        </h1>
    </header>

    <div class="content">
        <div class="padded-full">

          <div class="input-wrapper">
              <input class="with-label" type="number" min="0" max="2048" step="1" name="speed" id="speed" />
              <label class="floating-label" for="speed">Speed</label>
          </div>

          <div class="row text-center padded-top">
            <div class="phone-3 column">
              <button class="btn fit-parent primary icon icon-chevron-left" onclick="{ rotateLeft }"></button>
            </div>
            <div class="phone-1 column">&nbsp;</div>
            <div class="phone-4 column">
              <button class="btn fit-parent negative" onclick="{ stop }">Stop</button>
            </div>
            <div class="phone-1 column">&nbsp;</div>
            <div class="phone-3 column">
              <button class="btn fit-parent primary icon icon-chevron-right" onclick="{ rotateRight }"></button>
            </div>
          </div>

          <button class="btn fit-parent padded-top" onclick="{ setHome }">Set Home</button>
          <button class="btn fit-parent padded-top" onclick="{ getPosition }">Get Position</button>
        </div>

    </div>

    <script>
        import phonon from 'phonon'
        import { rotate, stop, setHome, getPosition } from '../js/tmclAPI'
        import { enterMotor } from '../js/ui/dialogs.js'

        this.speed.value = 100

        this.module = () => this.state().tmcl.modules.find(m => m.address == this.address)

        this.setHome = () => {
          setHome(this.address, this.motor)
        }

        this.getPosition = () => {
          getPosition(this.address, this.motor)
        }

        this.rotateLeft = () => {
          rotate(this.address, this.motor, 'left', parseInt(this.speed.value))
        }

        this.rotateRight = () => {
          rotate(this.address, this.motor, 'right', parseInt(this.speed.value))
        }

        this.stop = () => {
          stop(this.address, this.motor)
        }

        this.selectMotor = () => {
          enterMotor(this.address, this.motor)
        }

        const AP_ACTUAL_POSITION = 1

        // this.store.on('change', () => {
        //     let state = this.state()
        //     if (state.tmcl.axisParameters[AP_ACTUAL_POSITION]) {
        //       // quick hack: whenever there is a position (from GET_ACTUAL_POSITION)
        //       // we assume it's the end position
        //       let actualPosition = state.tmcl.axisParameters[AP_ACTUAL_POSITION]
        //       if (actualPosition != state.timelapse.endPosition) {
        //         console.debug('Timlapse: new end position ', actualPosition)
        //         this.store.dispatch(setEndPosition(actualPosition))
        //       }
        //     }
        // })

        this.on('hashchanged', (address = 1, motor = 0) => {
          this.address = parseInt(address)
          this.motor = parseInt(motor)
          this.update()
        })
    </script>
</move>
